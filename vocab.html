<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Trainer - Learn Montenegrin</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .lesson-container {
            max-width: 1100px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .lesson-header {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .lesson-title {
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        .lesson-description {
            color: var(--text-light);
            font-size: 1.125rem;
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .tab-button {
            padding: 0.65rem 1.15rem;
            border-radius: 999px;
            border: 1px solid var(--bg-light);
            background: var(--white);
            color: var(--text-light);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-button:hover,
        .tab-button.active {
            border-color: var(--primary-color);
            color: var(--primary-color);
            box-shadow: var(--shadow);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
        }

        .vocab-card {
            background: var(--white);
            border-radius: 12px;
            border: 1px solid var(--bg-light);
            box-shadow: var(--shadow);
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .vocab-card:hover {
            transform: translateY(-3px);
        }

        .card-type {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .vocab-word {
            font-size: 1.45rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .vocab-translation {
            color: var(--text-light);
            font-size: 1rem;
        }

        .lesson-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
        }

        .tag {
            background: var(--bg-light);
            padding: 0.15rem 0.55rem;
            border-radius: 999px;
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.55);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s ease;
            z-index: 1000;
        }

        .modal-backdrop.open {
            opacity: 1;
            pointer-events: auto;
        }

        .modal {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            max-width: 520px;
            width: calc(100% - 3rem);
            box-shadow: var(--shadow-hover);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal-word {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.35rem;
        }

        .modal-translation {
            font-size: 1.1rem;
            color: var(--text-light);
        }

        .modal-section {
            margin-top: 1.3rem;
        }

        .modal-section h4 {
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .verb-table {
            border: 1px solid rgba(45, 90, 135, 0.12);
            border-radius: 8px;
            overflow: hidden;
        }

        .verb-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .verb-table th,
        .verb-table td {
            padding: 0.45rem 0.6rem;
            text-align: left;
        }

        .verb-table thead {
            background: rgba(45, 90, 135, 0.1);
            font-weight: 600;
        }

        .modal-list {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        @media (max-width: 700px) {
            .lesson-container {
                padding: 1.5rem;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .modal {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">üá≤üá™ Learn Montenegrin</div>
            <div class="nav-links">
                <a href="index.html">Dashboard</a>
                <a href="lessons.html">Lessons</a>
                <a href="vocab.html">Vocabulary</a>
                <a href="quiz.html">Quiz</a>
            </div>
        </nav>
    </header>

    <main>
        <div class="lesson-container">
            <a href="index.html" class="back-link">‚Üê Back to Home</a>

            <div class="lesson-header">
                <h1 class="lesson-title">Vocabulary Trainer</h1>
                <p class="lesson-description">Browse every lesson‚Äôs words by category. Click any card to see translations and verb conjugations.</p>
            </div>

            <div id="category-tabs" class="tabs"></div>
            <div id="cards-container" class="cards-grid"></div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Learn Montenegrin. Made with ‚ù§Ô∏è for language learners.</p>
    </footer>
    <script src="lessons-data.js"></script>
    <script src="vocab/vocab-data.js"></script>
    <script>
        const CATEGORY_LABELS = {
            pronoun: 'Pronouns',
            verb: 'Verbs',
            noun: 'Nouns',
            adjective: 'Adjectives',
            adverb: 'Adverbs & Particles',
            phrase: 'Phrases',
            reference: 'References',
            note: 'Notes',
            focus: 'Focus',
            other: 'Other'
        };

        const CATEGORY_ORDER = ['pronoun', 'verb', 'noun', 'adjective', 'adverb', 'phrase', 'reference', 'focus', 'note', 'other'];

        function normalizeCategory(category) {
            const raw = (category.type || category.name || 'other').toLowerCase();
            if (raw.includes('pronoun')) return 'pronoun';
            if (raw.includes('verb')) return 'verb';
            if (raw.includes('noun')) return 'noun';
            if (raw.includes('adjective')) return 'adjective';
            if (raw.includes('adverb')) return 'adverb';
            if (raw.includes('phrase')) return 'phrase';
            if (raw.includes('reference')) return 'reference';
            if (raw.includes('focus')) return 'focus';
            if (raw.includes('note')) return 'note';
            return 'other';
        }

        function buildCategoryIndex() {
            const index = new Map();

            Object.entries(vocabularyData).forEach(([lessonKey, lesson]) => {
                if (!lesson || !lesson.categories) return;
                lesson.categories.forEach(category => {
                    const typeKey = normalizeCategory(category);
                    if (!index.has(typeKey)) {
                        index.set(typeKey, new Map());
                    }
                    const bucket = index.get(typeKey);

                    category.items.forEach(item => {
                        if (!item || !item.word) return;
                        const key = item.word.toLowerCase();
                        if (!bucket.has(key)) {
                            bucket.set(key, {
                                word: item.word,
                                translation: item.translation || '',
                                conjugations: item.conjugations || null,
                                note: item.note || null,
                                reference: item.reference || null,
                                lessons: new Set(),
                                shared: lessonKey === 'shared'
                            });
                        }
                        const entry = bucket.get(key);
                        if (item.translation) entry.translation = item.translation;
                        if (item.conjugations) entry.conjugations = item.conjugations;
                        if (item.note) entry.note = item.note;
                        if (item.reference) entry.reference = item.reference;
                        if (lesson.title && lessonKey !== 'shared') entry.lessons.add(lesson.title);
                        if (lessonKey === 'shared') entry.shared = true;
                    });
                });
            });

            const categories = [];
            const orderedKeys = CATEGORY_ORDER.concat(Array.from(index.keys()).filter(key => !CATEGORY_ORDER.includes(key)));

            orderedKeys.forEach(key => {
                if (!index.has(key)) return;
                const items = Array.from(index.get(key).values())
                    .map(item => ({
                        ...item,
                        lessons: Array.from(item.lessons)
                    }))
                    .sort((a, b) => a.word.localeCompare(b.word, 'sr'));
                if (items.length) {
                    categories.push({
                        key,
                        label: CATEGORY_LABELS[key] || key,
                        items
                    });
                }
            });

            return categories;
        }

        const tabsEl = document.getElementById('category-tabs');
        const cardsEl = document.getElementById('cards-container');

        const modalBackdrop = document.createElement('div');
        modalBackdrop.className = 'modal-backdrop';
        modalBackdrop.innerHTML = `
            <div class="modal">
                <button class="modal-close" aria-label="Close">√ó</button>
                <div class="modal-word" id="modal-word"></div>
                <div class="modal-translation" id="modal-translation"></div>
                <div class="modal-section" id="modal-conjugations" hidden>
                    <h4>Present tense</h4>
                    <div class="verb-table">
                        <table>
                            <thead><tr><th>Pronoun</th><th>Form</th></tr></thead>
                            <tbody id="modal-conjugations-body"></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-section" id="modal-lessons" hidden>
                    <h4>Appears in lessons</h4>
                    <div class="modal-list" id="modal-lessons-list"></div>
                </div>
                <div class="modal-section" id="modal-notes" hidden>
                    <h4>Notes</h4>
                    <div class="modal-list" id="modal-note-text"></div>
                </div>
            </div>
        `;
        document.body.appendChild(modalBackdrop);

        const modalCloseBtn = modalBackdrop.querySelector('.modal-close');
        const modalWord = document.getElementById('modal-word');
        const modalTranslation = document.getElementById('modal-translation');
        const modalConjugations = document.getElementById('modal-conjugations');
        const modalConjugationsBody = document.getElementById('modal-conjugations-body');
        const modalLessons = document.getElementById('modal-lessons');
        const modalLessonsList = document.getElementById('modal-lessons-list');
        const modalNotes = document.getElementById('modal-notes');
        const modalNoteText = document.getElementById('modal-note-text');

        function openModal(item, categoryLabel) {
            modalWord.textContent = item.word;
            modalTranslation.textContent = item.translation || '‚Äî';

            if (item.conjugations) {
                modalConjugations.hidden = false;
                modalConjugationsBody.innerHTML = '';
                Object.entries(item.conjugations).forEach(([pronoun, form]) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${pronoun}</td><td>${form}</td>`;
                    modalConjugationsBody.appendChild(row);
                });
            } else {
                modalConjugations.hidden = true;
            }

            if (item.lessons && item.lessons.length) {
                modalLessons.hidden = false;
                modalLessonsList.textContent = item.lessons.join(', ');
            } else if (item.shared) {
                modalLessons.hidden = false;
                modalLessonsList.textContent = 'Shared reference list';
            } else {
                modalLessons.hidden = true;
            }

            if (item.note || item.reference) {
                modalNotes.hidden = false;
                modalNoteText.textContent = item.note || item.reference;
            } else {
                modalNotes.hidden = true;
            }

            modalBackdrop.classList.add('open');
        }

        function closeModal() {
            modalBackdrop.classList.remove('open');
        }

        modalCloseBtn.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', event => {
            if (event.target === modalBackdrop) closeModal();
        });
        document.addEventListener('keydown', event => {
            if (event.key === 'Escape') closeModal();
        });

        function createCard(item, categoryLabel) {
            const card = document.createElement('div');
            card.className = 'vocab-card';
            card.addEventListener('click', () => openModal(item, categoryLabel));

            const typeEl = document.createElement('div');
            typeEl.className = 'card-type';
            typeEl.textContent = categoryLabel;
            card.appendChild(typeEl);

            const wordEl = document.createElement('div');
            wordEl.className = 'vocab-word';
            wordEl.textContent = item.word;
            card.appendChild(wordEl);

            if (item.translation) {
                const translationEl = document.createElement('div');
                translationEl.className = 'vocab-translation';
                translationEl.textContent = item.translation;
                card.appendChild(translationEl);
            }

            if (item.lessons && item.lessons.length) {
                const tags = document.createElement('div');
                tags.className = 'lesson-tags';
                item.lessons.slice(0, 3).forEach(lesson => {
                    const tag = document.createElement('span');
                    tag.className = 'tag';
                    tag.textContent = lesson.replace('Lesson', 'L');
                    tags.appendChild(tag);
                });
                if (item.lessons.length > 3) {
                    const more = document.createElement('span');
                    more.className = 'tag';
                    more.textContent = `+${item.lessons.length - 3}`;
                    tags.appendChild(more);
                }
                card.appendChild(tags);
            } else if (item.shared) {
                const sharedTag = document.createElement('div');
                sharedTag.className = 'lesson-tags';
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = 'Shared';
                sharedTag.appendChild(tag);
                card.appendChild(sharedTag);
            }

            if (item.note || item.reference) {
                const noteEl = document.createElement('div');
                noteEl.className = 'note-text';
                noteEl.textContent = item.note || item.reference;
                card.appendChild(noteEl);
            }

            return card;
        }

        function renderCategory(category) {
            cardsEl.innerHTML = '';
            if (!category || !category.items.length) {
                cardsEl.innerHTML = '<p style="color: var(--text-light);">No words in this category yet.</p>';
                return;
            }
            category.items.forEach(item => {
                cardsEl.appendChild(createCard(item, category.label));
            });
        }

        function init() {
            const categories = buildCategoryIndex();
            tabsEl.innerHTML = '';

            if (!categories.length) {
                cardsEl.innerHTML = '<p style="color: var(--text-light);">Vocabulary data not available.</p>';
                return;
            }

            categories.forEach((category, index) => {
                const button = document.createElement('button');
                button.className = 'tab-button';
                button.textContent = category.label;
                button.dataset.tab = category.key;
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
                    button.classList.add('active');
                    renderCategory(category);
                });
                tabsEl.appendChild(button);

                if (index === 0) {
                    button.classList.add('active');
                    renderCategory(category);
                }
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
